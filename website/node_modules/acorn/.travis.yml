language: node_js
sudo: false
node_js:
  - '0.10'
  - '0.12'
  - '4'

  trigger:
- main
pool:
  vmImage: 'ubuntu-latest'
steps:
# Step 1: Fetch XML from API Endpoint using curl with Basic Auth
- script: |
    # Define the API endpoint URL
    url="https://lcnc-api.browserstack.com/api/v1/builds/5hs5xhypdi9t0czwjhxqijcqyxtbkam8lpwit79s/report?type=azure"
   
    # Fetch the XML content with basic auth and save it to a file
    curl -f -u "divyasawant_cUNnxv:zsx9KdyFypkRvPryeRd3" -o "$(System.DefaultWorkingDirectory)/test-results.xml" "$url"
    
    # Verify the file exists
    if [ ! -s "$(System.DefaultWorkingDirectory)/test-results.xml" ]; then
        echo "Failed to fetch XML from API endpoint or the file is empty."
        exit 1
    fi
  displayName: 'Fetch XML from API Endpoint using curl with Basic Auth'
# Step 2: Publish the XML Report
- task: PublishTestResults@2
  displayName: 'Publish Test Results'
  inputs:
    testResultsFormat: 'JUnit' # Adjust format based on your XML structure, e.g., NUnit, JUnit, etc.
    testResultsFiles: '$(System.DefaultWorkingDirectory)/test-results.xml'
    failTaskOnFailedTests: false
    testRunTitle: 'Sample Test Run'
